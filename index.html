<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Availability Schedule</title>
  <style>
    /* â”€â”€ Tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --bg:              #f8f9fa;
      --bg-secondary:    #ffffff;
      --card:            #ffffff;
      --text-primary:    #1a1a2e;
      --text-secondary:  #64748b;
      --text-tertiary:   #94a3b8;
      --accent:          #6366f1;
      --accent-light:    rgba(99, 102, 241, 0.08);
      --accent-glow:     rgba(99, 102, 241, 0.15);
      --today-col:       rgba(99, 102, 241, 0.04);
      --today-border:    rgba(99, 102, 241, 0.2);
      --busy-bg:         linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
      --busy-border:     #f87171;
      --busy-text:       #991b1b;
      --free-bg:         linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      --free-border:     #34d399;
      --grid-line:       rgba(0, 0, 0, 0.06);
      --shadow-sm:       0 1px 2px rgba(0,0,0,0.04), 0 4px 12px rgba(0,0,0,0.03);
      --shadow-md:       0 4px 6px rgba(0,0,0,0.04), 0 10px 40px rgba(0,0,0,0.06);
      --shadow-glow:     0 0 0 3px var(--accent-glow);
      --radius-xl:       24px;
      --radius-lg:       16px;
      --radius-md:       12px;
      --radius-sm:       8px;
      --transition:      0.2s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* Dark mode */
    @media (prefers-color-scheme: dark) {
      :root {
        --bg:              #0f0f1a;
        --bg-secondary:    #1a1a2e;
        --card:            #1e1e32;
        --text-primary:    #f1f5f9;
        --text-secondary:  #94a3b8;
        --text-tertiary:   #64748b;
        --accent:          #818cf8;
        --accent-light:    rgba(129, 140, 248, 0.12);
        --accent-glow:     rgba(129, 140, 248, 0.2);
        --today-col:       rgba(129, 140, 248, 0.08);
        --today-border:    rgba(129, 140, 248, 0.3);
        --busy-bg:         linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
        --busy-border:     #dc2626;
        --busy-text:       #fecaca;
        --free-bg:         linear-gradient(135deg, #064e3b 0%, #065f46 100%);
        --free-border:     #10b981;
        --grid-line:       rgba(255, 255, 255, 0.06);
        --shadow-sm:       0 1px 2px rgba(0,0,0,0.2), 0 4px 12px rgba(0,0,0,0.15);
        --shadow-md:       0 4px 6px rgba(0,0,0,0.2), 0 10px 40px rgba(0,0,0,0.25);
      }
    }

    [data-theme="dark"] {
      --bg:              #0f0f1a;
      --bg-secondary:    #1a1a2e;
      --card:            #1e1e32;
      --text-primary:    #f1f5f9;
      --text-secondary:  #94a3b8;
      --text-tertiary:   #64748b;
      --accent:          #818cf8;
      --accent-light:    rgba(129, 140, 248, 0.12);
      --accent-glow:     rgba(129, 140, 248, 0.2);
      --today-col:       rgba(129, 140, 248, 0.08);
      --today-border:    rgba(129, 140, 248, 0.3);
      --busy-bg:         linear-gradient(135deg, #7f1d1d 0%, #991b1b 100%);
      --busy-border:     #dc2626;
      --busy-text:       #fecaca;
      --free-bg:         linear-gradient(135deg, #064e3b 0%, #065f46 100%);
      --free-border:     #10b981;
      --grid-line:       rgba(255, 255, 255, 0.06);
      --shadow-sm:       0 1px 2px rgba(0,0,0,0.2), 0 4px 12px rgba(0,0,0,0.15);
      --shadow-md:       0 4px 6px rgba(0,0,0,0.2), 0 10px 40px rgba(0,0,0,0.25);
    }

    [data-theme="light"] {
      --bg:              #f8f9fa;
      --bg-secondary:    #ffffff;
      --card:            #ffffff;
      --text-primary:    #1a1a2e;
      --text-secondary:  #64748b;
      --text-tertiary:   #94a3b8;
      --accent:          #6366f1;
      --accent-light:    rgba(99, 102, 241, 0.08);
      --accent-glow:     rgba(99, 102, 241, 0.15);
      --today-col:       rgba(99, 102, 241, 0.04);
      --today-border:    rgba(99, 102, 241, 0.2);
      --busy-bg:         linear-gradient(135deg, #fecaca 0%, #fca5a5 100%);
      --busy-border:     #f87171;
      --busy-text:       #991b1b;
      --free-bg:         linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
      --free-border:     #34d399;
      --grid-line:       rgba(0, 0, 0, 0.06);
      --shadow-sm:       0 1px 2px rgba(0,0,0,0.04), 0 4px 12px rgba(0,0,0,0.03);
      --shadow-md:       0 4px 6px rgba(0,0,0,0.04), 0 10px 40px rgba(0,0,0,0.06);
    }

    /* â”€â”€ Reset â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Inter',
                   'Segoe UI', Roboto, sans-serif;
      background: var(--bg);
      color: var(--text-primary);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      transition: background var(--transition), color var(--transition);
    }

    /* â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      position: sticky;
      top: 0;
      z-index: 200;
      background: var(--bg-secondary);
      backdrop-filter: saturate(180%) blur(20px);
      -webkit-backdrop-filter: saturate(180%) blur(20px);
      border-bottom: 1px solid var(--grid-line);
      padding: 20px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      transition: background var(--transition);
    }

    .header-left {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    header h1 {
      font-size: 1.5rem;
      font-weight: 700;
      letter-spacing: -0.03em;
      color: var(--text-primary);
      line-height: 1.2;
    }

    header p {
      font-size: 0.875rem;
      color: var(--text-secondary);
      font-weight: 450;
    }

    .theme-toggle {
      background: var(--accent-light);
      border: none;
      border-radius: var(--radius-md);
      width: 44px;
      height: 44px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.25rem;
      transition: all var(--transition);
    }
    .theme-toggle:hover {
      background: var(--accent);
      color: white;
      box-shadow: var(--shadow-glow);
    }

    /* â”€â”€ Page layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 32px 24px 80px;
    }

    /* â”€â”€ Setup notice â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .notice {
      display: flex;
      align-items: flex-start;
      gap: 12px;
      background: linear-gradient(135deg, rgba(251, 191, 36, 0.12) 0%, rgba(245, 158, 11, 0.08) 100%);
      border: 1px solid rgba(245, 158, 11, 0.3);
      border-radius: var(--radius-lg);
      padding: 16px 20px;
      margin-bottom: 24px;
      font-size: 0.875rem;
      color: var(--text-primary);
      line-height: 1.6;
    }
    .notice-icon { font-size: 1.125rem; flex-shrink: 0; margin-top: 1px; }
    .notice strong { font-weight: 600; display: block; margin-bottom: 4px; }

    /* â”€â”€ Controls bar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 16px;
    }

    /* Week navigation */
    .week-nav {
      display: flex;
      align-items: center;
      gap: 4px;
      background: var(--card);
      border-radius: 980px;
      box-shadow: var(--shadow-sm);
      padding: 6px;
      border: 1px solid var(--grid-line);
    }

    .week-nav button {
      background: transparent;
      border: none;
      border-radius: 980px;
      width: 36px;
      height: 36px;
      cursor: pointer;
      font-size: 1.125rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all var(--transition);
      flex-shrink: 0;
    }
    .week-nav button:hover {
      background: var(--accent-light);
      transform: scale(1.05);
    }
    .week-nav button:active {
      transform: scale(0.95);
    }

    .week-label {
      font-size: 0.95rem;
      font-weight: 600;
      letter-spacing: -0.01em;
      color: var(--text-primary);
      min-width: 200px;
      text-align: center;
      padding: 0 8px;
    }

    /* Legend */
    .legend {
      display: flex;
      gap: 20px;
      align-items: center;
      font-size: 0.8rem;
      font-weight: 500;
      color: var(--text-secondary);
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .legend-dot {
      width: 14px;
      height: 14px;
      border-radius: var(--radius-sm);
      box-shadow: var(--shadow-sm);
    }
    .legend-dot.free {
      background: var(--free-bg);
      border: 1.5px solid var(--free-border);
    }
    .legend-dot.busy {
      background: var(--busy-bg);
      border: 1.5px solid var(--busy-border);
    }

    /* â”€â”€ Calendar card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cal-card {
      background: var(--card);
      border-radius: var(--radius-xl);
      box-shadow: var(--shadow-md);
      overflow: hidden;
      border: 1px solid var(--grid-line);
      transition: background var(--transition), border var(--transition);
    }

    /* Day header row */
    .cal-header {
      display: grid;
      grid-template-columns: 56px repeat(7, 1fr);
      border-bottom: 1px solid var(--grid-line);
      background: var(--bg-secondary);
    }

    .col-time-hdr { /* spacer */ }

    .day-hdr {
      padding: 16px 8px 14px;
      text-align: center;
      border-left: 1px solid var(--grid-line);
      transition: background var(--transition);
    }
    .day-hdr.today {
      background: var(--today-col);
      position: relative;
    }
    .day-hdr.today::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: var(--accent);
    }

    .day-hdr .dow {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--text-tertiary);
      margin-bottom: 6px;
    }
    .day-hdr.today .dow { color: var(--accent); }

    .day-hdr .dom {
      font-size: 1.25rem;
      font-weight: 700;
      letter-spacing: -0.02em;
      color: var(--text-primary);
      width: 38px;
      height: 38px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin: 0 auto;
      border-radius: 50%;
      transition: all var(--transition);
    }
    .day-hdr.today .dom {
      background: var(--accent);
      color: white;
      box-shadow: var(--shadow-glow);
    }

    /* Body grid */
    .cal-body {
      display: grid;
      grid-template-columns: 56px repeat(7, 1fr);
    }

    .col-time { /* time labels */ }

    .time-tick {
      height: 56px;
      display: flex;
      align-items: flex-start;
      justify-content: flex-end;
      padding: 6px 12px 0 0;
      font-size: 0.7rem;
      font-weight: 500;
      letter-spacing: 0.02em;
      color: var(--text-tertiary);
      border-top: 1px solid var(--grid-line);
    }
    .time-tick:first-child { border-top: none; }

    .day-col {
      position: relative;
      border-left: 1px solid var(--grid-line);
    }
    .day-col.today-col {
      background: var(--today-col);
    }

    .bg-slot {
      height: 56px;
      border-top: 1px solid var(--grid-line);
    }
    .bg-slot:first-child { border-top: none; }

    /* Event blocks */
    .event-block {
      position: absolute;
      left: 4px;
      right: 4px;
      background: var(--busy-bg);
      border-left: 3px solid var(--busy-border);
      border-radius: var(--radius-sm);
      font-size: 0.7rem;
      font-weight: 600;
      color: var(--busy-text);
      padding: 4px 8px;
      overflow: hidden;
      z-index: 1;
      white-space: nowrap;
      text-overflow: ellipsis;
      box-shadow: var(--shadow-sm);
      transition: transform var(--transition), box-shadow var(--transition);
    }
    .event-block:hover {
      transform: scale(1.02);
      box-shadow: var(--shadow-md);
      z-index: 10;
    }

    /* Footer */
    .cal-footer {
      padding: 14px 20px;
      font-size: 0.75rem;
      color: var(--text-tertiary);
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
      border-top: 1px solid var(--grid-line);
      background: var(--bg-secondary);
    }

    /* State messages */
    .state-msg {
      padding: 80px 32px;
      text-align: center;
      color: var(--text-tertiary);
      font-size: 0.95rem;
    }

    /* â”€â”€ Responsive â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    @media (max-width: 768px) {
      header {
        padding: 16px 20px;
        flex-direction: column;
        gap: 12px;
        align-items: flex-start;
      }
      .theme-toggle {
        position: absolute;
        top: 16px;
        right: 20px;
      }
      header h1 { font-size: 1.25rem; }
      .container { padding: 20px 16px 60px; }
      .cal-header, .cal-body { grid-template-columns: 44px repeat(7, 1fr); }
      .time-tick { padding-right: 8px; font-size: 0.6rem; }
      .day-hdr { padding: 10px 4px; }
      .day-hdr .dow { font-size: 0.6rem; }
      .day-hdr .dom { font-size: 1rem; width: 30px; height: 30px; }
      .week-label { font-size: 0.85rem; min-width: 160px; }
      .legend { gap: 12px; font-size: 0.75rem; }
      .event-block { left: 2px; right: 2px; font-size: 0.6rem; padding: 2px 4px; }
    }

    @media (max-width: 480px) {
      .cal-header, .cal-body { grid-template-columns: repeat(7, 1fr); }
      .col-time-hdr, .col-time { display: none; }
      .controls { flex-direction: column; align-items: stretch; }
      .week-nav { justify-content: center; }
    }
  </style>
</head>
<body>

<header>
  <div class="header-left">
    <h1 id="page-title">Availability</h1>
    <p id="page-subtitle">Loading...</p>
  </div>
  <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme" title="Toggle dark/light mode">
    <span id="theme-icon">ğŸŒ™</span>
  </button>
</header>

<div class="container">

  <div id="setup-notice" class="notice" style="display:none">
    <span class="notice-icon">âš™ï¸</span>
    <div>
      <strong>Setup not yet complete</strong>
      No calendar connected. Add your ICS URL(s) as a GitHub Secret named <code>ICS_URLS</code>,
      then run the "Update Schedule" GitHub Action.
    </div>
  </div>

  <div class="controls">
    <div class="week-nav">
      <button onclick="changeWeek(-1)" aria-label="Previous week">â€¹</button>
      <span class="week-label" id="week-label"></span>
      <button onclick="changeWeek(1)" aria-label="Next week">â€º</button>
    </div>
    <div class="legend">
      <div class="legend-item"><div class="legend-dot free"></div>Available</div>
      <div class="legend-item"><div class="legend-dot busy"></div>Busy</div>
    </div>
  </div>

  <div class="cal-card" id="cal-card">
    <div class="state-msg">Loading schedule...</div>
  </div>

  <div class="cal-footer" id="cal-footer" style="display:none">
    <span id="last-updated-label"></span>
    <span>Green = available Â· Red = busy</span>
  </div>

</div>

<script>
/* â”€â”€â”€ Theme Toggle â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getPreferredTheme() {
  const stored = localStorage.getItem('theme');
  if (stored) return stored;
  return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
}

function setTheme(theme) {
  document.documentElement.setAttribute('data-theme', theme);
  localStorage.setItem('theme', theme);
  document.getElementById('theme-icon').textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
}

function toggleTheme() {
  const current = document.documentElement.getAttribute('data-theme') || getPreferredTheme();
  setTheme(current === 'dark' ? 'light' : 'dark');
}

// Initialize theme
setTheme(getPreferredTheme());

/* â”€â”€â”€ Constants â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
const DOW  = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
const MONS = ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'];
const PX_PER_HOUR = 56;

/* â”€â”€â”€ State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
let data          = null;
let weekOffset    = 0;
let workStart     = 8;
let workEnd       = 19;

/* â”€â”€â”€ Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function getMondayOf(d) {
  const t = new Date(d);
  const dow = t.getDay();
  t.setDate(t.getDate() - (dow === 0 ? 6 : dow - 1));
  t.setHours(0, 0, 0, 0);
  return t;
}

function fmt(d) {
  return `${d.getDate()} ${MONS[d.getMonth()]}`;
}

function isToday(d) {
  const n = new Date();
  return d.getDate() === n.getDate() && d.getMonth() === n.getMonth() && d.getFullYear() === n.getFullYear();
}

function fmtTime(hour) {
  if (hour === 0)  return '12am';
  if (hour === 12) return '12pm';
  return hour < 12 ? `${hour}am` : `${hour - 12}pm`;
}

/* â”€â”€â”€ Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
function renderWeek() {
  if (!data) return;

  const baseMonday = getMondayOf(new Date());
  const weekStart  = new Date(baseMonday);
  weekStart.setDate(baseMonday.getDate() + weekOffset * 7);

  const weekEnd = new Date(weekStart);
  weekEnd.setDate(weekStart.getDate() + 7);

  // Week label
  const labelEnd = new Date(weekStart);
  labelEnd.setDate(weekStart.getDate() + 6);
  document.getElementById('week-label').textContent =
    `${fmt(weekStart)} â€“ ${fmt(labelEnd)} ${labelEnd.getFullYear()}`;

  // Build days array (Mon â†’ Sun)
  const days = [];
  for (let i = 0; i < 7; i++) {
    const d = new Date(weekStart);
    d.setDate(weekStart.getDate() + i);
    days.push(d);
  }

  // Filter events to this week
  const weekEvents = (data.events || []).filter(e => {
    const s = new Date(e.start), en = new Date(e.end);
    return s < weekEnd && en > weekStart;
  });

  const hourCount = workEnd - workStart;
  const bodyH     = hourCount * PX_PER_HOUR;

  let h = '';

  /* Header row */
  h += '<div class="cal-header">';
  h += '<div class="col-time-hdr"></div>';
  for (const d of days) {
    const cls = isToday(d) ? 'day-hdr today' : 'day-hdr';
    h += `<div class="${cls}">
      <div class="dow">${DOW[d.getDay()]}</div>
      <div class="dom">${d.getDate()}</div>
    </div>`;
  }
  h += '</div>';

  /* Body */
  h += '<div class="cal-body">';

  /* Time column */
  h += '<div class="col-time">';
  for (let hr = workStart; hr < workEnd; hr++) {
    h += `<div class="time-tick">${fmtTime(hr)}</div>`;
  }
  h += '</div>';

  /* Day columns */
  for (const d of days) {
    const dayStart = new Date(d); dayStart.setHours(workStart, 0, 0, 0);
    const dayEnd   = new Date(d); dayEnd.setHours(workEnd,   0, 0, 0);

    const todayCls = isToday(d) ? ' today-col' : '';
    h += `<div class="day-col${todayCls}" style="height:${bodyH}px">`;

    /* Background slots */
    for (let i = 0; i < hourCount; i++) {
      h += '<div class="bg-slot"></div>';
    }

    /* Events */
    const dayEvts = weekEvents.filter(e => {
      const s = new Date(e.start), en = new Date(e.end);
      return s < dayEnd && en > dayStart;
    });

    for (const ev of dayEvts) {
      const s  = new Date(ev.start);
      const en = new Date(ev.end);
      const cs = s  < dayStart ? dayStart : s;
      const ce = en > dayEnd   ? dayEnd   : en;
      const startMins = (cs - dayStart) / 60000;
      const durMins   = (ce - cs) / 60000;
      if (durMins <= 0) continue;

      const top    = (startMins / 60) * PX_PER_HOUR;
      const height = Math.max((durMins / 60) * PX_PER_HOUR, 6);

      h += `<div class="event-block" style="top:${top}px;height:${height}px" title="Busy">
        ${height > 18 ? 'Busy' : ''}
      </div>`;
    }

    h += '</div>';
  }

  h += '</div>';

  document.getElementById('cal-card').innerHTML = h;

  /* Footer */
  const footer = document.getElementById('cal-footer');
  footer.style.display = 'flex';
  const lu = data.lastUpdated
    ? `Updated ${new Date(data.lastUpdated).toLocaleString('en-GB', {dateStyle:'medium', timeStyle:'short'})}`
    : '';
  document.getElementById('last-updated-label').textContent = lu;
}

function changeWeek(dir) {
  weekOffset = Math.max(-2, Math.min(weekOffset + dir, 10));
  renderWeek();
}

/* â”€â”€â”€ Boot â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
async function init() {
  try {
    const res  = await fetch(`schedule.json?_=${Date.now()}`);
    if (!res.ok) throw new Error('HTTP ' + res.status);
    data = await res.json();

    workStart = data.workdayStart ?? 8;
    workEnd   = data.workdayEnd   ?? 19;

    const name  = data.ownerName           || 'Schedule';
    const hours = data.weeklyProjectHours  || 20;

    document.getElementById('page-title').textContent    = `${name}'s Availability`;
    document.getElementById('page-subtitle').textContent =
      `${hours} hours/week available for the Dashboard project`;
    document.title = `${name}'s Availability`;

    if (!data.configured) {
      document.getElementById('setup-notice').style.display = 'flex';
    }

    renderWeek();
  } catch (err) {
    document.getElementById('cal-card').innerHTML =
      '<div class="state-msg">Could not load schedule.json â€” please check the setup.</div>';
    console.error(err);
  }
}

init();
</script>
</body>
</html>
